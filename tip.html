<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>JPYC æŠ•ã’éŠ­</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    #stamp {
      font-size: 40px;
      display: none;
      color: orange;
      animation: pop 0.5s;
    }
    @keyframes pop {
      0% { transform: scale(0); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <h2>JPYC æŠ•ã’éŠ­</h2>

  <button id="connect">MetaMask æ¥ç¶š</button>
  <br><br>

  <label>é‡‘é¡:</label>
  <select id="amount">
    <option value="100">100å††</option>
    <option value="500" selected>500å††</option>
    <option value="1000">1000å††</option>
  </select>
  <button id="tip">é€ã‚‹</button>

  <p id="status"></p>
  <div id="stamp">ğŸ‰ã‚ã‚ŠãŒã¨ã†ï¼</div>

<script>
if (!window.ethereum && !navigator.userAgent.includes("MetaMask")) {
    // ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®URLã‹ã‚‰ https:// ã‚’é™¤ã„ãŸéƒ¨åˆ†ã‚’å–å¾—
    const targetUrl = window.location.href.replace(/^https?:\/\//, '');
    // ç›´æ¥çš„ãªãƒªãƒ³ã‚¯å½¢å¼ã«ä¿®æ­£
    location.href = `https://metamask.app.link/dapp/${targetUrl}`;
}


  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰é…ä¿¡è€…ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—
  const params = new URLSearchParams(window.location.search);
  const TO_ADDRESS = params.get('to') || "0xè‡ªåˆ†ã®ã‚¢ãƒ‰ãƒ¬ã‚¹"; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚‚è¨­å®šå¯

  const JPYC_ADDRESS = "0xE7C3D8C9a439feDe00D2600032D5dB0Be71C3c29"; // Polygon JPYC
  const JPYC_ABI = [
    "function transfer(address to, uint256 amount) returns (bool)",
    
  ];

  let signer;
  let jpyc;

  document.getElementById("connect").onclick = async () => {
    if (!window.ethereum) {
      alert("MetaMaskãŒå¿…è¦ã§ã™");
      return;
    }

    await ethereum.request({ method: "eth_requestAccounts" });
    const provider = new ethers.providers.Web3Provider(window.ethereum);
    signer = provider.getSigner();
    jpyc = new ethers.Contract(JPYC_ADDRESS, JPYC_ABI, signer);

    document.getElementById("status").innerText = "æ¥ç¶šå®Œäº†";
  };

  document.getElementById("tip").onclick = async () => {
    try {
      document.getElementById("status").innerText = "é€é‡‘ä¸­â€¦";

      const value = ethers.utils.parseUnits(document.getElementById("amount").value,
  18
);


      const tx = await jpyc.transfer(TO_ADDRESS, value);
      await tx.wait();

      document.getElementById("status").innerText = "é€é‡‘å®Œäº†ï¼";
      const stamp = document.getElementById("stamp");
      stamp.style.display = "block";
      setTimeout(() => { stamp.style.display = "none"; }, 1500);

    } catch (e) {
  console.error(e);
  document.getElementById("status").innerText =
    e?.data?.message || e?.message || "é€é‡‘å¤±æ•—";
}

  };
</script>
</body>
</html>

